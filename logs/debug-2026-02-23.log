{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"Logger initialized - Environment: development","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"Log Level: debug","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"Log Directory: C:\\Users\\Mig\\Desktop\\tfg\\EZBar_Backend\\logs","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"‚úÖ Cache service initialized (TTL: 300s, Check period: 60s)","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"--- [AUTO-FIX] Iniciando correcci√≥n de esquema (CASCADE) ---","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"SSL certificates not found. Generating self-signed certificate for development...","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"warn","message":"OpenSSL not available. Using Node.js crypto for certificate generation...","service":"ezbar-api","timestamp":"2026-02-23 00:06:53"}
{"level":"info","message":"‚úÖ Self-signed SSL certificate generated successfully using Node.js crypto","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"‚úÖ SSL certificates loaded successfully","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"debug","message":"Key: C:\\Users\\Mig\\Desktop\\tfg\\EZBar_Backend\\Api\\api\\certs\\dev-key.pem","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"debug","message":"Cert: C:\\Users\\Mig\\Desktop\\tfg\\EZBar_Backend\\Api\\api\\certs\\dev-cert.pem","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"Starting memory monitor (interval: 60000ms)","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"debug","message":"Memory: 23.69MB / 36.74MB (64.48%)","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"‚úÖ Graceful shutdown handlers initialized","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"‚úÖ EZBar API started successfully","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üìù Log Level: debug","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üíæ Cache: ENABLED","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"‚è±Ô∏è  Request Timeout: 30000ms","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üîí HTTPS: ENABLED","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üì° UDP Discovery escuchando en el puerto 3001","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üöÄ HTTP Server running on http://0.0.0.0:3000","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üåç Environment: development","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üìä Database: EZBarDB@localhost","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üîó Backend URL: http://localhost:8080/api","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üîí HTTPS Server running on https://0.0.0.0:3443","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üåç Environment: development","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"============================================================","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"database":"EZBarDB","host":"localhost","level":"info","message":"‚úÖ Conexi√≥n exitosa a MariaDB","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"debug","message":"DB Query: SET FOREIGN_KEY_CHECKS = 0... (716ms)","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"info","message":"üìä DATOS INICIALES: Encontrados 0 productos y 0 categor√≠as.","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"warn","message":"‚ö†Ô∏è ALERTA: La tabla de productos est√° VAC√çA en esta base de datos.","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"debug","message":"DB Query: \n          SELECT CONSTRAINT_NAME FROM information_schema.KEY_COLUMN_USAGE \n          WHERE TABLE_NA... (5ms)","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"error":"You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '2' at line 1","level":"error","message":"Database query error:","query":"ALTER TABLE detalle_pedidos DROP FOREIGN KEY 2","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"level":"warn","message":"[AUTO-FIX] Aviso en detalle_pedidos: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '2' at line 1","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"error":"Duplicate FOREIGN KEY constraint name 'detalle_pedidos_ibfk_2'","level":"error","message":"Database query error:","query":"\n        ALTER TABLE detalle_pedidos \n        ADD CONSTRAINT detalle_pedidos_ibfk_2 \n        FOREIGN","service":"ezbar-api","timestamp":"2026-02-23 00:06:54"}
{"code":"ER_FK_DUP_NAME","errno":1826,"level":"error","message":"Duplicate FOREIGN KEY constraint name 'detalle_pedidos_ibfk_2'","service":"ezbar-api","sql":"\n        ALTER TABLE detalle_pedidos \n        ADD CONSTRAINT detalle_pedidos_ibfk_2 \n        FOREIGN KEY (producto_id) \n        REFERENCES productos(producto_id) \n        ON DELETE CASCADE\n      ","sqlMessage":"Duplicate FOREIGN KEY constraint name 'detalle_pedidos_ibfk_2'","sqlState":"HY000","stack":"Error: Duplicate FOREIGN KEY constraint name 'detalle_pedidos_ibfk_2'\n    at PromisePool.query (C:\\Users\\Mig\\Desktop\\tfg\\EZBar_Backend\\Api\\api\\node_modules\\mysql2\\lib\\promise\\pool.js:36:22)\n    at pool.query (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/config/database.js:55:26)\n    at file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/app.js:35:18\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2026-02-23 00:06:54"}
{"ip":"127.0.0.1","level":"info","message":"GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","timestamp":"2026-02-23 00:07:18","userAgent":"Mozilla/5.0 (Windows NT; Windows NT 10.0; es-ES) WindowsPowerShell/5.1.26100.7705"}
{"body":{},"error":"Request failed with status code 401","ip":"127.0.0.1","level":"error","message":"Error processing GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","stack":"AxiosError: Request failed with status code 401\n    at settle (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/settle.js:19:12)\n    at IncomingMessage.handleStreamEnd (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/adapters/http.js:793:11)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/Axios.js:45:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async fetchWithRetry (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/utils/retryHelper.js:6:22)\n    at async obtenerPedidos (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/controllers/pedidosController.js:26:22)","timestamp":"2026-02-23 00:07:18"}
{"ip":"127.0.0.1","level":"warn","message":"GET /api/pedidos 401 - 70ms","responseTime":70,"service":"ezbar-api","statusCode":401,"timestamp":"2026-02-23 00:07:18"}
{"ip":"127.0.0.1","level":"info","message":"GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","timestamp":"2026-02-23 00:07:21","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36"}
{"body":{},"error":"Request failed with status code 401","ip":"127.0.0.1","level":"error","message":"Error processing GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","stack":"AxiosError: Request failed with status code 401\n    at settle (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/settle.js:19:12)\n    at IncomingMessage.handleStreamEnd (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/adapters/http.js:793:11)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/Axios.js:45:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async fetchWithRetry (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/utils/retryHelper.js:6:22)\n    at async obtenerPedidos (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/controllers/pedidosController.js:26:22)","timestamp":"2026-02-23 00:07:21"}
{"ip":"127.0.0.1","level":"warn","message":"GET /api/pedidos 401 - 26ms","responseTime":26,"service":"ezbar-api","statusCode":401,"timestamp":"2026-02-23 00:07:21"}
{"ip":"127.0.0.1","level":"info","message":"GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","timestamp":"2026-02-23 00:07:51","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36"}
{"body":{},"error":"Request failed with status code 401","ip":"127.0.0.1","level":"error","message":"Error processing GET /api/pedidos","params":{},"query":{},"service":"ezbar-api","stack":"AxiosError: Request failed with status code 401\n    at settle (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/settle.js:19:12)\n    at IncomingMessage.handleStreamEnd (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/adapters/http.js:793:11)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/node_modules/axios/lib/core/Axios.js:45:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async fetchWithRetry (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/utils/retryHelper.js:6:22)\n    at async obtenerPedidos (file:///C:/Users/Mig/Desktop/tfg/EZBar_Backend/Api/api/src/controllers/pedidosController.js:26:22)","timestamp":"2026-02-23 00:07:51"}
{"ip":"127.0.0.1","level":"warn","message":"GET /api/pedidos 401 - 24ms","responseTime":24,"service":"ezbar-api","statusCode":401,"timestamp":"2026-02-23 00:07:51"}
{"level":"debug","message":"Memory: 20.67MB / 23.99MB (86.18%)","service":"ezbar-api","timestamp":"2026-02-23 00:07:54"}
{"external":"3.69MB","heapTotal":"23.99MB","heapUsed":"20.67MB","level":"warn","message":"üü° WARNING: Memory usage at 86.18%","rss":"67.04MB","service":"ezbar-api","timestamp":"2026-02-23 00:07:54","warningCount":1}
{"level":"debug","message":"Memory: 21.12MB / 24.24MB (87.14%)","service":"ezbar-api","timestamp":"2026-02-23 00:08:54"}
{"external":"3.72MB","heapTotal":"24.24MB","heapUsed":"21.12MB","level":"warn","message":"üü° WARNING: Memory usage at 87.14%","rss":"67.49MB","service":"ezbar-api","timestamp":"2026-02-23 00:08:54","warningCount":2}
{"level":"debug","message":"Memory: 21.14MB / 23.49MB (89.99%)","service":"ezbar-api","timestamp":"2026-02-23 00:09:54"}
{"external":"3.74MB","heapTotal":"23.49MB","heapUsed":"21.14MB","level":"warn","message":"üü° WARNING: Memory usage at 89.99%","rss":"67.93MB","service":"ezbar-api","timestamp":"2026-02-23 00:09:54","warningCount":3}
